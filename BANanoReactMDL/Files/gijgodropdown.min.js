gj.dropdown={plugins:{}},gj.dropdown.config={base:{dataSource:void 0,textField:"text",valueField:"value",selectedField:"selected",width:void 0,maxHeight:"auto",placeholder:void 0,fontSize:void 0,uiLibrary:"materialdesign",iconsLibrary:"materialicons",icons:{dropdown:'<i class="gj-icon arrow-dropdown" />',dropup:'<i class="gj-icon arrow-dropup" />'},style:{wrapper:"gj-dropdown gj-dropdown-md gj-unselectable",list:"gj-list gj-list-md gj-dropdown-list-md",active:"gj-list-md-active"}},bootstrap:{style:{wrapper:"gj-dropdown gj-dropdown-bootstrap gj-dropdown-bootstrap-3 gj-unselectable",presenter:"btn btn-default",list:"gj-list gj-list-bootstrap gj-dropdown-list-bootstrap list-group",item:"list-group-item",active:"active"},iconsLibrary:"glyphicons"},bootstrap4:{style:{wrapper:"gj-dropdown gj-dropdown-bootstrap gj-dropdown-bootstrap-4 gj-unselectable",presenter:"btn btn-outline-secondary",list:"gj-list gj-list-bootstrap gj-dropdown-list-bootstrap list-group",item:"list-group-item",active:"active"}},materialicons:{style:{expander:"gj-dropdown-expander-mi"}},fontawesome:{icons:{dropdown:'<i class="fa fa-caret-down" aria-hidden="true"></i>',dropup:'<i class="fa fa-caret-up" aria-hidden="true"></i>'},style:{expander:"gj-dropdown-expander-fa"}},glyphicons:{icons:{dropdown:'<span class="caret"></span>',dropup:'<span class="dropup"><span class="caret" ></span></span>'},style:{expander:"gj-dropdown-expander-glyphicons"}}},gj.dropdown.methods={init:function(jsConfig){return gj.widget.prototype.init.call(this,jsConfig,"dropdown"),this.attr("data-dropdown","true"),gj.dropdown.methods.initialize(this),this},getHTMLConfig:function(){var result=gj.widget.prototype.getHTMLConfig.call(this),attrs=this[0].attributes;return attrs.placeholder&&(result.placeholder=attrs.placeholder.value),result},initialize:function($dropdown){var $item,data=$dropdown.data(),$wrapper=$dropdown.parent('div[role="wrapper"]'),$display=$('<span role="display"></span>'),$expander=$('<span role="expander">'+data.icons.dropdown+"</span>").addClass(data.style.expander),$presenter=$('<button role="presenter" type="button"></button>').addClass(data.style.presenter),$list=$('<ul role="list" class="'+data.style.list+'"></ul>').attr("guid",$dropdown.attr("data-guid"));0===$wrapper.length?($wrapper=$('<div role="wrapper" />').addClass(data.style.wrapper),$dropdown.wrap($wrapper)):$wrapper.addClass(data.style.wrapper),data.fontSize&&$presenter.css("font-size",data.fontSize),$presenter.on("click",function(e){$list.is(":visible")?gj.dropdown.methods.close($dropdown,$list):gj.dropdown.methods.open($dropdown,$list)}),$presenter.on("blur",function(e){setTimeout(function(){gj.dropdown.methods.close($dropdown,$list)},500)}),$presenter.append($display).append($expander),$dropdown.hide(),$dropdown.after($presenter),$("body").append($list),$list.hide(),$dropdown.reload()},setListPosition:function(presenter,list,data){var top,listHeight,presenterHeight,newHeight,listElRect,mainElRect=presenter.getBoundingClientRect(),scrollY=window.scrollY||window.pageYOffset||0,scrollX=window.scrollX||window.pageXOffset||0;list.style.overflow="",list.style.overflowX="",list.style.height="",gj.core.setChildPosition(presenter,list),listHeight=gj.core.height(list,!0),listElRect=list.getBoundingClientRect(),presenterHeight=gj.core.height(presenter,!0),"auto"===data.maxHeight?mainElRect.top<listElRect.top?mainElRect.top+listHeight+presenterHeight>window.innerHeight&&(newHeight=window.innerHeight-mainElRect.top-presenterHeight-3):mainElRect.top-listHeight-3>0?list.style.top=Math.round(mainElRect.top+scrollY-listHeight-3)+"px":(list.style.top=scrollY+"px",newHeight=mainElRect.top-3):!isNaN(data.maxHeight)&&data.maxHeight<listHeight&&(newHeight=data.maxHeight),newHeight&&(list.style.overflow="scroll",list.style.overflowX="hidden",list.style.height=newHeight+"px")},useHtmlDataSource:function($dropdown,data){var dataSource=[],i,record,$options=$dropdown.find("option");for(i=0;i<$options.length;i++)(record={})[data.valueField]=$options[i].value,record[data.textField]=$options[i].innerHTML,record[data.selectedField]=$dropdown[0].value===$options[i].value,dataSource.push(record);data.dataSource=dataSource},filter:function($dropdown){var i,record,data=$dropdown.data();if(data.dataSource){if("string"==typeof data.dataSource[0])for(i=0;i<data.dataSource.length;i++)(record={})[data.valueField]=data.dataSource[i],record[data.textField]=data.dataSource[i],data.dataSource[i]=record}else data.dataSource=[];return data.dataSource},render:function($dropdown,response){var selections=[],data=$dropdown.data(),$parent=$dropdown.parent(),$list=$("body").children('[role="list"][guid="'+$dropdown.attr("data-guid")+'"]'),$presenter=$parent.children('[role="presenter"]'),$expander=$presenter.children('[role="expander"]'),$display=$presenter.children('[role="display"]');if($dropdown.data("records",response),$dropdown.empty(),$list.empty(),response&&response.length)if($.each(response,function(){var value=this[data.valueField],text=this[data.textField],selected=this[data.selectedField]&&"true"===this[data.selectedField].toString().toLowerCase(),i,$item;($item=$('<li value="'+value+'"><div data-role="wrapper"><span data-role="display">'+text+"</span></div></li>")).addClass(data.style.item),$item.on("click",function(e){gj.dropdown.methods.select($dropdown,value)}),$list.append($item),$dropdown.append('<option value="'+value+'">'+text+"</option>"),selected&&selections.push(value)}),0===selections.length)$dropdown.prepend('<option value=""></option>'),$dropdown[0].selectedIndex=0,data.placeholder&&($display[0].innerHTML='<span class="placeholder">'+data.placeholder+"</span>");else for(i=0;i<selections.length;i++)gj.dropdown.methods.select($dropdown,selections[i]);return data.width&&($parent.css("width",data.width),$presenter.css("width",data.width)),data.fontSize&&$list.children("li").css("font-size",data.fontSize),gj.dropdown.events.dataBound($dropdown),$dropdown},open:function($dropdown,$list){var data=$dropdown.data(),$expander=$dropdown.parent().find('[role="expander"]'),$presenter=$dropdown.parent().find('[role="presenter"]'),scrollParentEl=gj.core.getScrollParent($dropdown[0]);$list.css("width",gj.core.width($presenter[0])),$list.show(),gj.dropdown.methods.setListPosition($presenter[0],$list[0],data),$expander.html(data.icons.dropup),scrollParentEl&&(data.parentScrollHandler=function(){gj.dropdown.methods.setListPosition($presenter[0],$list[0],data)},gj.dropdown.methods.addParentsScrollListener(scrollParentEl,data.parentScrollHandler))},close:function($dropdown,$list){var data=$dropdown.data(),$expander=$dropdown.parent().find('[role="expander"]'),scrollParentEl=gj.core.getScrollParent($dropdown[0]);$expander.html(data.icons.dropdown),scrollParentEl&&data.parentScrollHandler&&gj.dropdown.methods.removeParentsScrollListener(scrollParentEl,data.parentScrollHandler),$list.hide()},addParentsScrollListener:function(el,handler){var scrollParentEl=gj.core.getScrollParent(el.parentNode);el.addEventListener("scroll",handler),scrollParentEl&&gj.dropdown.methods.addParentsScrollListener(scrollParentEl,handler)},removeParentsScrollListener:function(el,handler){var scrollParentEl=gj.core.getScrollParent(el.parentNode);el.removeEventListener("scroll",handler),scrollParentEl&&gj.dropdown.methods.removeParentsScrollListener(scrollParentEl,handler)},select:function($dropdown,value){var data=$dropdown.data(),$list=$("body").children('[role="list"][guid="'+$dropdown.attr("data-guid")+'"]'),$item=$list.children('li[value="'+value+'"]'),$display=$dropdown.next('[role="presenter"]').find('[role="display"]'),record=gj.dropdown.methods.getRecordByValue($dropdown,value);return $list.children("li").removeClass(data.style.active),record?($item.addClass(data.style.active),$dropdown[0].value=value,$display[0].innerHTML=record[data.textField]):(data.placeholder&&($display[0].innerHTML='<span class="placeholder">'+data.placeholder+"</span>"),$dropdown[0].value=""),gj.dropdown.events.change($dropdown),gj.dropdown.methods.close($dropdown,$list),$dropdown},getRecordByValue:function($dropdown,value){var data=$dropdown.data(),i,result=void 0;for(i=0;i<data.records.length;i++)if(data.records[i][data.valueField]===value){result=data.records[i];break}return result},value:function($dropdown,value){return void 0===value?$dropdown.val():(gj.dropdown.methods.select($dropdown,value),$dropdown)},destroy:function($dropdown){var data=$dropdown.data(),$parent=$dropdown.parent('div[role="wrapper"]');return data&&($dropdown.xhr&&$dropdown.xhr.abort(),$dropdown.off(),$dropdown.removeData(),$dropdown.removeAttr("data-type").removeAttr("data-guid").removeAttr("data-dropdown"),$dropdown.removeClass(),$parent.length>0&&($parent.children('[role="presenter"]').remove(),$parent.children('[role="list"]').remove(),$dropdown.unwrap()),$dropdown.show()),$dropdown}},gj.dropdown.events={change:function($dropdown){return $dropdown.triggerHandler("change")},dataBound:function($dropdown){return $dropdown.triggerHandler("dataBound")}},gj.dropdown.widget=function($element,jsConfig){var self=this,methods=gj.dropdown.methods;return this.value=function(value){return methods.value(this,value)},this.enable=function(){return methods.enable(this)},this.disable=function(){return methods.disable(this)},this.destroy=function(){return methods.destroy(this)},$.extend($element,this),"true"!==$element.attr("data-dropdown")&&methods.init.call($element,jsConfig),$element},gj.dropdown.widget.prototype=new gj.widget,gj.dropdown.widget.constructor=gj.dropdown.widget,gj.dropdown.widget.prototype.getHTMLConfig=gj.dropdown.methods.getHTMLConfig,function($){$.fn.dropdown=function(method){var $widget;if(this&&this.length){if("object"!=typeof method&&method){if(($widget=new gj.dropdown.widget(this,null))[method])return $widget[method].apply(this,Array.prototype.slice.call(arguments,1));throw"Method "+method+" does not exist."}return new gj.dropdown.widget(this,method)}}}(jQuery);